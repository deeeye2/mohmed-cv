<!DOCTYPE html>
<html lang="en">
<head>
    <title>Mohamed's DevOps World</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
    <link rel="icon" href="{{ url_for('static', filename='images/favicon-32x32.png') }}" type="image/png">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/all.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/owl.carousel.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/owl.theme.default.min.css') }}">
    
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tooplate-ben-resume-style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/quiz.css') }}">
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background: black;
            color: white;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
        }
        .navbar {
            width: 100%;
            background-color: #007BFF;
            padding: 15px;
        }
        .navbar-brand {
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        .navbar-nav .nav-link {
            color: white;
            margin: 0 15px;
        }
        .container {
            background-color: #333;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            padding: 20px;
            width: 80%;
            max-width: 1000px;
            text-align: center;
            overflow-y: auto;
            max-height: 90vh;
            margin-top: 20px;
            margin: 0 auto; /* Center the container */
        }
        h1 {
            margin-bottom: 20px;
            color: #333;
        }
        .form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .form-fields {
            width: 100%;
            margin-bottom: 20px;
        }
        label, select, input {
            width: 100%;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        select[multiple] {
            height: auto;
        }
        .btn {
            background-color: #007BFF;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 5px 2px;
            cursor: pointer;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
        .hidden {
            display: none;
        }
        .preview {
            margin-top: 20px;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            text-align: left;
            width: 100%;
        }
        .logout-btn {
            background-color: #007BFF;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 5px 2px;
            cursor: pointer;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            z-index: 10; /* Ensure the button is on top */
        }
        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div class="navbar">
        <span class="navbar-brand">Mohamed's DevOps World</span>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
    <div class="container">
        <h1>File Generator</h1>
        <!-- Kubernetes Manifest Generator -->
        <h2>Kubernetes Manifest Generator</h2>
        <div id="k8sSelectionStep">
            <label for="k8sManifestType">Select Kubernetes Manifest Types:</label>
            <select id="k8sManifestType" name="k8sManifestType" multiple size="10">
                <option value="Deployment">Deployment</option>
                <option value="Service">Service</option>
                <option value="ConfigMap">ConfigMap</option>
                <option value="Secret">Secret</option>
                <option value="PersistentVolume">PersistentVolume</option>
                <option value="PersistentVolumeClaim">PersistentVolumeClaim</option>
                <option value="Ingress">Ingress</option>
                <option value="Role">Role</option>
                <option value="RoleBinding">RoleBinding</option>
                <option value="ClusterRole">ClusterRole</option>
                <option value="ClusterRoleBinding">ClusterRoleBinding</option>
                <option value="NetworkPolicy">NetworkPolicy</option>
            </select>
            <button type="button" class="btn" onclick="goToK8sDetails()">Next</button>
        </div>
        <div id="k8sDetailsStep" class="hidden">
            <form id="k8sManifestForm" class="form">
                <div id="k8sFormFields" class="form-fields"></div>
                <button type="button" class="btn" onclick="showK8sPreview()">Preview</button>
            </form>
            <button type="button" class="btn" onclick="goBackK8s()">Back</button>
        </div>
        <div id="k8sPreviewStep" class="preview hidden">
            <h2>Preview</h2>
            <pre id="k8sPreviewContent"></pre>
            <button class="btn" onclick="generateK8sManifest()">Download</button>
            <button class="btn" onclick="editK8sForm()">Edit</button>
            <button class="btn" onclick="cancelK8sForm()">Cancel</button>
        </div>
        <!-- Dockerfile Generator -->
        <h2>Dockerfile Generator</h2>
        <div id="dockerfileSelectionStep">
            <label for="dockerfileBaseImage">Select Base Image:</label>
            <select id="dockerfileBaseImage" name="dockerfileBaseImage">
                <option value="node">Node.js</option>
                <option value="python">Python</option>
                <option value="golang">Go</option>
                <option value="java">Java</option>
                <option value="nginx">Nginx</option>
                <option value="alpine">Alpine</option>
            </select>
            <button type="button" class="btn" onclick="goToDockerfileDetails()">Next</button>
        </div>
        <div id="dockerfileDetailsStep" class="hidden">
            <form id="dockerfileForm" class="form">
                <div id="dockerfileFormFields" class="form-fields"></div>
                <button type="button" class="btn" onclick="showDockerfilePreview()">Preview</button>
            </form>
            <button type="button" class="btn" onclick="goBackDockerfile()">Back</button>
        </div>
        <div id="dockerfilePreviewStep" class="preview hidden">
            <h2>Preview</h2>
            <pre id="dockerfilePreviewContent"></pre>
            <button class="btn" onclick="generateDockerfile()">Download</button>
            <button class="btn" onclick="editDockerfileForm()">Edit</button>
            <button class="btn" onclick="cancelDockerfileForm()">Cancel</button>
        </div>
        <!-- Ansible Playbook Generator -->
        <h2>Ansible Playbook Generator</h2>
        <div id="ansibleSelectionStep">
            <label for="ansiblePlaybookType">Select Playbook Tasks:</label>
            <select id="ansiblePlaybookType" name="ansiblePlaybookType" multiple size="10">
                <option value="package">Package</option>
                <option value="service">Service</option>
                <option value="file">File</option>
                <option value="copy">Copy</option>
                <option value="command">Command</option>
                <option value="user">User</option>
            </select>
            <button type="button" class="btn" onclick="goToAnsibleDetails()">Next</button>
        </div>
        <div id="ansibleDetailsStep" class="hidden">
            <form id="ansibleForm" class="form">
                <div id="ansibleFormFields" class="form-fields"></div>
                <button type="button" class="btn" onclick="showAnsiblePreview()">Preview</button>
            </form>
            <button type="button" class="btn" onclick="goBackAnsible()">Back</button>
        </div>
        <div id="ansiblePreviewStep" class="preview hidden">
            <h2>Preview</h2>
            <pre id="ansiblePreviewContent"></pre>
            <button class="btn" onclick="generateAnsiblePlaybook()">Download</button>
            <button class="btn" onclick="editAnsibleForm()">Edit</button>
            <button class="btn" onclick="cancelAnsibleForm()">Cancel</button>
        </div>
        <!-- Terraform Configuration Generator -->
        <h2>Terraform Configuration Generator</h2>
        <div id="terraformSelectionStep">
            <label for="terraformResourceType">Select Resource Types:</label>
            <select id="terraformResourceType" name="terraformResourceType" multiple size="10">
                <option value="aws_instance">AWS EC2 Instance</option>
                <option value="aws_s3_bucket">AWS S3 Bucket</option>
                <option value="aws_security_group">AWS Security Group</option>
                <option value="google_compute_instance">Google Compute Instance</option>
                <option value="google_storage_bucket">Google Storage Bucket</option>
                <option value="azure_virtual_machine">Azure Virtual Machine</option>
            </select>
            <button type="button" class="btn" onclick="goToTerraformDetails()">Next</button>
        </div>
        <div id="terraformDetailsStep" class="hidden">
            <form id="terraformForm" class="form">
                <div id="terraformFormFields" class="form-fields"></div>
                <button type="button" class="btn" onclick="showTerraformPreview()">Preview</button>
            </form>
            <button type="button" class="btn" onclick="goBackTerraform()">Back</button>
        </div>
        <div id="terraformPreviewStep" class="preview hidden">
            <h2>Preview</h2>
            <pre id="terraformPreviewContent"></pre>
            <button class="btn" onclick="generateTerraformConfig()">Download</button>
            <button class="btn" onclick="editTerraformForm()">Edit</button>
            <button class="btn" onclick="cancelTerraformForm()">Cancel</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script>
        function logout() {
            // Clear session or token (you may need to adjust this depending on your backend implementation)
            fetch('/logout', { method: 'POST' })
                .then(response => {
                    if (response.ok) {
                        alert('You have been successfully logged out.');
                        window.location.href = '/login';
                    } else {
                        alert('Logout failed. Please try again.');
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function goToK8sDetails() {
            const manifestTypeSelect = document.getElementById("k8sManifestType");
            const selectedOptions = Array.from(manifestTypeSelect.selectedOptions).map(option => option.value);

            if (selectedOptions.length === 0) {
                alert('Please select at least one manifest type.');
                return;
            }

            const formFieldsDiv = document.getElementById("k8sFormFields");
            formFieldsDiv.innerHTML = "";

            selectedOptions.forEach(type => {
                if (k8sFields[type]) {
                    const fieldSet = document.createElement('fieldset');
                    const legend = document.createElement('legend');
                    legend.textContent = type;
                    fieldSet.appendChild(legend);

                    k8sFields[type].forEach(field => {
                        const fieldHtml = field.options
                            ? `
                                <label for="${field.name}-${type}">${field.label}${field.required ? '*' : ''}:</label>
                                <select id="${field.name}-${type}" name="${field.name}-${type}" ${field.required ? 'required' : ''}>
                                    ${field.options.map(option => `<option value="${option}">${option}</option>`).join('')}
                                </select>
                                <br>
                            `
                            : `
                                <label for="${field.name}-${type}">${field.label}${field.required ? '*' : ''}:</label>
                                <input type="text" id="${field.name}-${type}" name="${field.name}-${type}" ${field.required ? 'required' : ''}>
                                <br>
                            `;
                        fieldSet.innerHTML += fieldHtml;
                    });

                    formFieldsDiv.appendChild(fieldSet);
                }
            });

            document.getElementById("k8sSelectionStep").classList.add("hidden");
            document.getElementById("k8sDetailsStep").classList.remove("hidden");
        }

        function goBackK8s() {
            document.getElementById("k8sSelectionStep").classList.remove("hidden");
            document.getElementById("k8sDetailsStep").classList.add("hidden");
        }

        function showK8sPreview() {
            const form = document.getElementById("k8sManifestForm");
            const formData = new FormData(form);
            const previewContent = document.getElementById("k8sPreviewContent");
            const manifestTypeSelect = document.getElementById("k8sManifestType");
            const selectedOptions = Array.from(manifestTypeSelect.selectedOptions).map(option => option.value);

            const manifests = [];

            selectedOptions.forEach(type => {
                let manifest = {};

                if (type === 'Deployment') {
                    manifest = {
                        apiVersion: 'apps/v1',
                        kind: 'Deployment',
                        metadata: {
                            name: formData.get(`name-Deployment`),
                        },
                        spec: {
                            replicas: parseInt(formData.get(`replicas-Deployment`)),
                            selector: {
                                matchLabels: {
                                    app: formData.get(`name-Deployment`)
                                }
                            },
                            template: {
                                metadata: {
                                    labels: {
                                        app: formData.get(`name-Deployment`)
                                    }
                                },
                                spec: {
                                    containers: [{
                                        name: formData.get(`name-Deployment`),
                                        image: formData.get(`image-Deployment`)
                                    }]
                                }
                            }
                        }
                    };
                    if (formData.get(`volume-Deployment`)) {
                        manifest.spec.template.spec.volumes = [{
                            name: formData.get(`volume-Deployment`)
                        }];
                    }
                } else if (type === 'Service') {
                    manifest = {
                        apiVersion: 'v1',
                        kind: 'Service',
                        metadata: {
                            name: formData.get(`name-Service`)
                        },
                        spec: {
                            type: formData.get(`type-Service`),
                            ports: [{
                                port: parseInt(formData.get(`port-Service`))
                            }],
                            selector: {
                                app: formData.get(`name-Service`)
                            }
                        }
                    };
                } else if (type === 'ConfigMap') {
                    manifest = {
                        apiVersion: 'v1',
                        kind: 'ConfigMap',
                        metadata: {
                            name: formData.get(`name-ConfigMap`)
                        },
                        data: {
                            [formData.get(`name-ConfigMap`)]: formData.get(`data-ConfigMap`)
                        }
                    };
                } else if (type === 'Secret') {
                    manifest = {
                        apiVersion: 'v1',
                        kind: 'Secret',
                        metadata: {
                            name: formData.get(`name-Secret`)
                        },
                        data: {
                            [formData.get(`name-Secret`)]: formData.get(`data-Secret`)
                        }
                    };
                } else if (type === 'PersistentVolume') {
                    manifest = {
                        apiVersion: 'v1',
                        kind: 'PersistentVolume',
                        metadata: {
                            name: formData.get(`name-PersistentVolume`)
                        },
                        spec: {
                            capacity: {
                                storage: formData.get(`capacity-PersistentVolume`)
                            },
                            accessModes: [formData.get(`accessModes-PersistentVolume`)],
                            storageClassName: formData.get(`storageClass-PersistentVolume`)
                        }
                    };
                } else if (type === 'PersistentVolumeClaim') {
                    manifest = {
                        apiVersion: 'v1',
                        kind: 'PersistentVolumeClaim',
                        metadata: {
                            name: formData.get(`name-PersistentVolumeClaim`)
                        },
                        spec: {
                            storageClassName: formData.get(`storageClass-PersistentVolumeClaim`),
                            accessModes: [formData.get(`accessModes-PersistentVolumeClaim`)],
                            resources: {
                                requests: {
                                    storage: formData.get(`resources-PersistentVolumeClaim`)
                                }
                            }
                        }
                    };
                } else if (type === 'Ingress') {
                    manifest = {
                        apiVersion: 'networking.k8s.io/v1',
                        kind: 'Ingress',
                        metadata: {
                            name: formData.get(`name-Ingress`)
                        },
                        spec: {
                            rules: [{
                                host: formData.get(`host-Ingress`),
                                http: {
                                    paths: [{
                                        path: '/',
                                        pathType: 'Prefix',
                                        backend: {
                                            service: {
                                                name: formData.get(`serviceName-Ingress`),
                                                port: {
                                                    number: parseInt(formData.get(`servicePort-Ingress`))
                                                }
                                            }
                                        }
                                    }]
                                }
                            }]
                        }
                    };
                } else if (type === 'Role') {
                    manifest = {
                        apiVersion: 'rbac.authorization.k8s.io/v1',
                        kind: 'Role',
                        metadata: {
                            name: formData.get(`name-Role`)
                        },
                        rules: JSON.parse(formData.get(`rules-Role`))
                    };
                } else if (type === 'RoleBinding') {
                    manifest = {
                        apiVersion: 'rbac.authorization.k8s.io/v1',
                        kind: 'RoleBinding',
                        metadata: {
                            name: formData.get(`name-RoleBinding`)
                        },
                        roleRef: {
                            apiGroup: 'rbac.authorization.k8s.io',
                            kind: 'Role',
                            name: formData.get(`roleName-RoleBinding`)
                        },
                        subjects: JSON.parse(formData.get(`subjects-RoleBinding`))
                    };
                } else if (type === 'ClusterRole') {
                    manifest = {
                        apiVersion: 'rbac.authorization.k8s.io/v1',
                        kind: 'ClusterRole',
                        metadata: {
                            name: formData.get(`name-ClusterRole`)
                        },
                        rules: JSON.parse(formData.get(`rules-ClusterRole`))
                    };
                } else if (type === 'ClusterRoleBinding') {
                    manifest = {
                        apiVersion: 'rbac.authorization.k8s.io/v1',
                        kind: 'ClusterRoleBinding',
                        metadata: {
                            name: formData.get(`name-ClusterRoleBinding`)
                        },
                        roleRef: {
                            apiGroup: 'rbac.authorization.k8s.io',
                            kind: 'ClusterRole',
                            name: formData.get(`roleName-ClusterRoleBinding`)
                        },
                        subjects: JSON.parse(formData.get(`subjects-ClusterRoleBinding`))
                    };
                } else if (type === 'NetworkPolicy') {
                    manifest = {
                        apiVersion: 'networking.k8s.io/v1',
                        kind: 'NetworkPolicy',
                        metadata: {
                            name: formData.get(`name-NetworkPolicy`)
                        },
                        spec: {
                            podSelector: JSON.parse(formData.get(`podSelector-NetworkPolicy`)),
                            policyTypes: [formData.get(`policyTypes-NetworkPolicy`)]
                        }
                    };
                }

                manifests.push(manifest);
            });

            previewContent.textContent = manifests.map(manifest => JSON.stringify(manifest, null, 2)).join('\n---\n');
            document.getElementById("k8sDetailsStep").classList.add("hidden");
            document.getElementById("k8sPreviewStep").classList.remove("hidden");
        }

        function generateK8sManifest() {
            const previewContent = document.getElementById("k8sPreviewContent").textContent;
            const blob = new Blob([previewContent], { type: 'application/yaml' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'manifest.yaml';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function editK8sForm() {
            document.getElementById("k8sPreviewStep").classList.add("hidden");
            document.getElementById("k8sDetailsStep").classList.remove("hidden");
        }

        function cancelK8sForm() {
            document.getElementById("k8sManifestForm").reset();
            document.getElementById("k8sFormFields").innerHTML = "";
            document.getElementById("k8sSelectionStep").classList.remove("hidden");
            document.getElementById("k8sDetailsStep").classList.add("hidden");
            document.getElementById("k8sPreviewStep").classList.add("hidden");
        }

        function goToDockerfileDetails() {
            const baseImage = document.getElementById("dockerfileBaseImage").value;

            if (!baseImage) {
                alert('Please select a base image.');
                return;
            }

            const formFieldsDiv = document.getElementById("dockerfileFormFields");
            formFieldsDiv.innerHTML = "";

            if (dockerfileFields[baseImage]) {
                dockerfileFields[baseImage].forEach(field => {
                    const fieldHtml = field.options
                        ? `
                            <label for="${field.name}-${baseImage}">${field.label}${field.required ? '*' : ''}:</label>
                            <select id="${field.name}-${baseImage}" name="${field.name}-${baseImage}" ${field.required ? 'required' : ''}>
                                ${field.options.map(option => `<option value="${option}">${option}</option>`).join('')}
                            </select>
                            <br>
                        `
                        : `
                            <label for="${field.name}-${baseImage}">${field.label}${field.required ? '*' : ''}:</label>
                            <input type="text" id="${field.name}-${baseImage}" name="${field.name}-${baseImage}" ${field.required ? 'required' : ''}>
                            <br>
                        `;
                    formFieldsDiv.innerHTML += fieldHtml;
                });
            }

            document.getElementById("dockerfileSelectionStep").classList.add("hidden");
            document.getElementById("dockerfileDetailsStep").classList.remove("hidden");
        }

        function goBackDockerfile() {
            document.getElementById("dockerfileSelectionStep").classList.remove("hidden");
            document.getElementById("dockerfileDetailsStep").classList.add("hidden");
        }

        function showDockerfilePreview() {
            const form = document.getElementById("dockerfileForm");
            const formData = new FormData(form);
            const previewContent = document.getElementById("dockerfilePreviewContent");
            const baseImage = document.getElementById("dockerfileBaseImage").value;

            let dockerfile = `FROM ${baseImage}:${formData.get(`version-${baseImage}`)}\n`;

            if (baseImage === "node" || baseImage === "python" || baseImage === "golang" || baseImage === "java") {
                dockerfile += `
WORKDIR /usr/src/app
COPY . .
RUN npm install
CMD ["${formData.get(`startCommand-${baseImage}`)}"]
                `;
            } else if (baseImage === "nginx") {
                dockerfile += `
COPY ${formData.get(`configFile-${baseImage}`)} /etc/nginx/nginx.conf
COPY ${formData.get(`documentRoot-${baseImage}`)} /usr/share/nginx/html
                `;
            } else if (baseImage === "alpine") {
                dockerfile += `
RUN ${formData.get(`commands-${baseImage}`)}
                `;
            }

            previewContent.textContent = dockerfile.trim();
            document.getElementById("dockerfileDetailsStep").classList.add("hidden");
            document.getElementById("dockerfilePreviewStep").classList.remove("hidden");
        }

        function generateDockerfile() {
            const previewContent = document.getElementById("dockerfilePreviewContent").textContent;
            const blob = new Blob([previewContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'Dockerfile';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function editDockerfileForm() {
            document.getElementById("dockerfilePreviewStep").classList.add("hidden");
            document.getElementById("dockerfileDetailsStep").classList.remove("hidden");
        }

        function cancelDockerfileForm() {
            document.getElementById("dockerfileForm").reset();
            document.getElementById("dockerfileFormFields").innerHTML = "";
            document.getElementById("dockerfileSelectionStep").classList.remove("hidden");
            document.getElementById("dockerfileDetailsStep").classList.add("hidden");
            document.getElementById("dockerfilePreviewStep").classList.add("hidden");
        }

        function goToAnsibleDetails() {
            const playbookTypeSelect = document.getElementById("ansiblePlaybookType");
            const selectedOptions = Array.from(playbookTypeSelect.selectedOptions).map(option => option.value);

            if (selectedOptions.length === 0) {
                alert('Please select at least one playbook task.');
                return;
            }

            const formFieldsDiv = document.getElementById("ansibleFormFields");
            formFieldsDiv.innerHTML = "";

            selectedOptions.forEach(type => {
                if (ansibleFields[type]) {
                    const fieldSet = document.createElement('fieldset');
                    const legend = document.createElement('legend');
                    legend.textContent = type.charAt(0).toUpperCase() + type.slice(1);
                    fieldSet.appendChild(legend);

                    ansibleFields[type].forEach(field => {
                        const fieldHtml = field.options
                            ? `
                                <label for="${field.name}-${type}">${field.label}${field.required ? '*' : ''}:</label>
                                <select id="${field.name}-${type}" name="${field.name}-${type}" ${field.required ? 'required' : ''}>
                                    ${field.options.map(option => `<option value="${option}">${option}</option>`).join('')}
                                </select>
                                <br>
                            `
                            : `
                                <label for="${field.name}-${type}">${field.label}${field.required ? '*' : ''}:</label>
                                <input type="text" id="${field.name}-${type}" name="${field.name}-${type}" ${field.required ? 'required' : ''}>
                                <br>
                            `;
                        fieldSet.innerHTML += fieldHtml;
                    });

                    formFieldsDiv.appendChild(fieldSet);
                }
            });

            document.getElementById("ansibleSelectionStep").classList.add("hidden");
            document.getElementById("ansibleDetailsStep").classList.remove("hidden");
        }

        function goBackAnsible() {
            document.getElementById("ansibleSelectionStep").classList.remove("hidden");
            document.getElementById("ansibleDetailsStep").classList.add("hidden");
        }

        function showAnsiblePreview() {
            const form = document.getElementById("ansibleForm");
            const formData = new FormData(form);
            const previewContent = document.getElementById("ansiblePreviewContent");
            const playbookTypeSelect = document.getElementById("ansiblePlaybookType");
            const selectedOptions = Array.from(playbookTypeSelect.selectedOptions).map(option => option.value);

            const tasks = selectedOptions.map(type => {
                let task = { [type]: {} };

                ansibleFields[type].forEach(field => {
                    task[type][field.name] = formData.get(`${field.name}-${type}`);
                });

                return task;
            });

            const playbook = {
                hosts: "all",
                tasks: tasks
            };

            previewContent.textContent = jsyaml.dump(playbook, 4, 2);
            document.getElementById("ansibleDetailsStep").classList.add("hidden");
            document.getElementById("ansiblePreviewStep").classList.remove("hidden");
        }

        function generateAnsiblePlaybook() {
            const previewContent = document.getElementById("ansiblePreviewContent").textContent;
            const blob = new Blob([previewContent], { type: 'application/yaml' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'playbook.yml';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function editAnsibleForm() {
            document.getElementById("ansiblePreviewStep").classList.add("hidden");
            document.getElementById("ansibleDetailsStep").classList.remove("hidden");
        }

        function cancelAnsibleForm() {
            document.getElementById("ansibleForm").reset();
            document.getElementById("ansibleFormFields").innerHTML = "";
            document.getElementById("ansibleSelectionStep").classList.remove("hidden");
            document.getElementById("ansibleDetailsStep").classList.add("hidden");
            document.getElementById("ansiblePreviewStep").classList.add("hidden");
        }

        function goToTerraformDetails() {
            const resourceTypeSelect = document.getElementById("terraformResourceType");
            const selectedOptions = Array.from(resourceTypeSelect.selectedOptions).map(option => option.value);

            if (selectedOptions.length === 0) {
                alert('Please select at least one resource type.');
                return;
            }

            const formFieldsDiv = document.getElementById("terraformFormFields");
            formFieldsDiv.innerHTML = "";

            selectedOptions.forEach(type => {
                if (terraformFields[type]) {
                    const fieldSet = document.createElement('fieldset');
                    const legend = document.createElement('legend');
                    legend.textContent = type.replace(/_/g, ' ').toUpperCase();
                    fieldSet.appendChild(legend);

                    terraformFields[type].forEach(field => {
                        const fieldHtml = field.options
                            ? `
                                <label for="${field.name}-${type}">${field.label}${field.required ? '*' : ''}:</label>
                                <select id="${field.name}-${type}" name="${field.name}-${type}" ${field.required ? 'required' : ''}>
                                    ${field.options.map(option => `<option value="${option}">${option}</option>`).join('')}
                                </select>
                                <br>
                            `
                            : `
                                <label for="${field.name}-${type}">${field.label}${field.required ? '*' : ''}:</label>
                                <input type="text" id="${field.name}-${type}" name="${field.name}-${type}" ${field.required ? 'required' : ''}>
                                <br>
                            `;
                        fieldSet.innerHTML += fieldHtml;
                    });

                    formFieldsDiv.appendChild(fieldSet);
                }
            });

            document.getElementById("terraformSelectionStep").classList.add("hidden");
            document.getElementById("terraformDetailsStep").classList.remove("hidden");
        }

        function goBackTerraform() {
            document.getElementById("terraformSelectionStep").classList.remove("hidden");
            document.getElementById("terraformDetailsStep").classList.add("hidden");
        }

        function showTerraformPreview() {
            const form = document.getElementById("terraformForm");
            const formData = new FormData(form);
            const previewContent = document.getElementById("terraformPreviewContent");
            const resourceTypeSelect = document.getElementById("terraformResourceType");
            const selectedOptions = Array.from(resourceTypeSelect.selectedOptions).map(option => option.value);

            const resources = selectedOptions.map(type => {
                let resource = { [type]: {} };

                terraformFields[type].forEach(field => {
                    resource[type][field.name] = formData.get(`${field.name}-${type}`);
                });

                return resource;
            });

            const terraformConfig = resources.map(resource => {
                const type = Object.keys(resource)[0];
                const config = resource[type];
                return `
resource "${type}" "${config.name || config.bucket || config.name}" {
    ${Object.keys(config).map(key => `${key} = "${config[key]}"`).join('\n    ')}
}
                `;
            }).join('\n');

            previewContent.textContent = terraformConfig.trim();
            document.getElementById("terraformDetailsStep").classList.add("hidden");
            document.getElementById("terraformPreviewStep").classList.remove("hidden");
        }

        function generateTerraformConfig() {
            const previewContent = document.getElementById("terraformPreviewContent").textContent;
            const blob = new Blob([previewContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'main.tf';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function editTerraformForm() {
            document.getElementById("terraformPreviewStep").classList.add("hidden");
            document.getElementById("terraformDetailsStep").classList.remove("hidden");
        }

        function cancelTerraformForm() {
            document.getElementById("terraformForm").reset();
            document.getElementById("terraformFormFields").innerHTML = "";
            document.getElementById("terraformSelectionStep").classList.remove("hidden");
            document.getElementById("terraformDetailsStep").classList.add("hidden");
            document.getElementById("terraformPreviewStep").classList.add("hidden");
        }
    </script>
</body>
</html>

